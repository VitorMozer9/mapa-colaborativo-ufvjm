<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mapa Colaborativo UFVJM</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="assets/css/map.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400;700&display=swap" rel="stylesheet">
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  </head>
<body>
  
  <!--Barra de Busca-->
  <div id="map"></div>
  <div class="searchbar">
    <input id="searchInput" type="text" placeholder="Pesquise o local desejado" />
    <div class="chips">
      
      <button class="chip deselected" data-cat="Departamentos">
        <img src="assets/img/Mapa/logo2.png" alt="Logo2" class="logo2-img">Departamentos
        
        
      </button>
      
      <button class="chip deselected" data-cat="Lanchonetes">
        <img src="assets/img/Mapa/logo3.png" alt="Logo3" class="logo3-img">Lanchonetes</button>
      
      <button class="chip deselected " data-cat="Eventos">
        <img src="assets/img/Mapa/logo4.png" alt="Logo4" class="logo4-img">Eventos</button>
      
    </div>
  </div>


  <!--Barra Lateral-->
  <div class="sidebar">

    <div class="logo">

      <a href="index.html" class="logo-ufvjm">

        <img src="assets/img/Mapa/logo.png" alt="Logo" class="logo-img">

        <span class="leaf"></span>
        
      </a>
  </div>


<!--Icones da barra lateral-->
  <div class="menu">
    <div class="item">

      <img src="assets/img/Mapa/pngegg2.png" alt="Ícone2" class="icon2">
      <span>Salvos</span>
    </div>

    <div class="item">
       <img src="assets/img/Mapa/pngegg1.png" alt="Ícone1" class="icon1">
      <span>Favoritos</span>
    </div>

    <div class="item">
      <img src="assets/img/Mapa/pngegg.png" alt="Ícone" class="icon">
      <span>Eventos</span>
    </div>
  </div>
</div>




 
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      if (typeof L === 'undefined') {
        var el = document.getElementById('map');
        el.textContent = 'Falha ao carregar Leaflet. Verifique sua conexão com a internet.';
        el.style.display = 'flex';
        el.style.alignItems = 'center';
        el.style.justifyContent = 'center';
        el.style.color = '#b00020';
        el.style.fontFamily = 'system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
        return;
      }

      var map = L.map('map', { maxBoundsViscosity: 1.0 });

      var imageUrl = 'assets/img/Mapa/mapa-quadrado.png';

    var areaPoints = [
        [-18.20596, -43.58189],
        [-18.18906, -43.56978],
        [-18.20199, -43.56016],
        [-18.21125, -43.56789]
      ];
    var bounds = L.latLngBounds(areaPoints);
    var polyLatLngs = areaPoints.map(function(p){ return L.latLng(p[0], p[1]); });

      map.setMinZoom(16.5);   
      map.setMaxZoom(18);   
      map.setMaxBounds(bounds);
      map.fitBounds(bounds);

      var overlay = L.imageOverlay(imageUrl, bounds, { opacity: 1 }).addTo(map);
      overlay.on('error', function() {
        L.popup().setLatLng(map.getCenter()).setContent('Imagem base não encontrada em '+imageUrl).openOn(map);
      });

      function pointInPolygon(latlng, poly) {
        var x = latlng.lng, y = latlng.lat;
        var inside = false;
        for (var i = 0, j = poly.length - 1; i < poly.length; j = i++) {
          var xi = poly[i].lng, yi = poly[i].lat;
          var xj = poly[j].lng, yj = poly[j].lat;
          var intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
          if (intersect) inside = !inside;
        }
        return inside;
      }

      var clickMarker;
      map.on('click', function(e) {
        if (!pointInPolygon(e.latlng, polyLatLngs)) return;
        if (clickMarker) map.removeLayer(clickMarker);
        clickMarker = L.marker(e.latlng).addTo(map);
        clickMarker.bindPopup('Novo ponto: ' + e.latlng.lat.toFixed(5) + ', ' + e.latlng.lng.toFixed(5)).openPopup();
      });

      document.getElementById('locate').addEventListener('click', function() {
        if (!navigator.geolocation) return;
        navigator.geolocation.getCurrentPosition(function(pos) {
        var latlng = [pos.coords.latitude, pos.coords.longitude];
        var ll = L.latLng(latlng[0], latlng[1]);
        if (!pointInPolygon(ll, polyLatLngs)) {
          L.popup().setLatLng(map.getCenter()).setContent('Fora da área delimitada').openOn(map);
          return;
        }
        map.setView(latlng, 16);
        L.circleMarker(latlng, { radius: 8, color: '#1976d2' }).addTo(map).bindPopup('Você está aqui').openPopup();
      });
      });


      

    });
  </script>
</body>