<!-- Documento HTML5 -->
<!DOCTYPE html>
<!-- Define o idioma da p√°gina como Portugu√™s (Brasil) -->
<html lang="pt-BR">

<head>
  <!-- Metadados b√°sicos -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- T√≠tulo exibido na aba do navegador -->
  <title>Mapa Colaborativo UFVJM</title>

  <!-- Estilos do Leaflet para o mapa -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Estilos pr√≥prios da p√°gina -->
  <link rel="stylesheet" href="assets/css/map.css" />

  <!-- Otimiza√ß√£o de carregamento de fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <!-- Fonte Gabarito usada na interface -->
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400;700&display=swap" rel="stylesheet">

  <!-- Biblioteca Leaflet para mapas -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>

  <!-- Cont√™iner do mapa Leaflet -->
  <div id="map"></div>

  <!-- Barra de busca e chips de categorias -->
  <div class="searchbar">
    <!-- Campo de pesquisa de locais -->
    <input id="searchInput" type="text" placeholder="Pesquise o local desejado" />
    <div class="chips">
      <!-- Filtro: Departamentos -->
      <button class="chip deselected" data-cat="Departamentos">
        <img src="assets/img/Mapa/logo2.png" alt="Logo2" class="logo2-img">Departamentos
      </button>

      <!-- Filtro: Lanchonetes -->
      <button class="chip deselected" data-cat="Lanchonetes">
        <img src="assets/img/Mapa/logo3.png" alt="Logo3" class="logo3-img">Lanchonetes
      </button>

      <!-- Filtro: Eventos -->
      <button class="chip deselected " data-cat="Eventos">
        <img src="assets/img/Mapa/logo4.png" alt="Logo4" class="logo4-img">Eventos
      </button>
    </div>
  </div>

  <!-- Barra lateral com navega√ß√£o -->
  <div class="sidebar">
    <!-- Logotipo e atalho para a p√°gina inicial -->
    <div class="logo">
      <a href="index.html" class="logo-ufvjm">
        <img src="assets/img/Mapa/logo.png" alt="Logo" class="logo-img">
        <span class="leaf"></span>
      </a>
    </div>

    <!-- Menu de navega√ß√£o lateral -->
    <div class="menu">
      <!-- Item: Salvos -->
      <div class="item">
        <img src="assets/img/Mapa/pngegg2.png" alt="√çcone2" class="icon2">
        <span>Salvos</span>
      </div>

      <!-- Item: Favoritos -->
      <div class="item">
        <img src="assets/img/Mapa/pngegg1.png" alt="√çcone1" class="icon1">
        <span>Favoritos</span>
      </div>

      <!-- Item: Eventos -->
      <div class="item">
        <img src="assets/img/Mapa/pngegg.png" alt="√çcone" class="icon">
        <span>Eventos</span>
      </div>

      <!-- Link para o perfil do usu√°rio -->
      <div class="item menu-profile-bottom">
        <a href="perfil_usuario.html" class="menu-profile-link">
          <img src="assets/img/perfil-usu√°rio/user.png" alt="Perfil" class="icon-profile profile-avatar-img" />
          <span>Perfil</span>
        </a>
      </div>
    </div>
  </div>





  <script>
    // Aguarda a constru√ß√£o do DOM antes de iniciar o mapa
    window.addEventListener('DOMContentLoaded', function () {
      // Verifica se a biblioteca Leaflet foi carregada
      if (typeof L === 'undefined') {
        var el = document.getElementById('map');
        el.textContent = 'Falha ao carregar Leaflet. Verifique sua conex√£o com a internet.';
        el.style.display = 'flex';
        el.style.alignItems = 'center';
        el.style.justifyContent = 'center';
        el.style.color = '#b00020';
        el.style.fontFamily = 'system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
        return;
      }

      // Cria o mapa Leaflet associado ao elemento #map
      var map = L.map('map', { maxBoundsViscosity: 1.0 });

      // Caminho da imagem base usada como overlay
      var imageUrl = 'assets/img/Mapa/mapa-quadrado.png';

      // Pontos delimitadores da √°rea original (lat, lng)
      var areaPoints = [
        [-18.20596, -43.58189],
        [-18.18906, -43.56978],
        [-18.20199, -43.56016],
        [-18.21125, -43.56789]
      ];
      // Calcula limites em formato Leaflet
      var bounds = L.latLngBounds(areaPoints);
      // Converte para objetos LatLng
      var polyLatLngs = areaPoints.map(function (p) { return L.latLng(p[0], p[1]); });

      // Ajusta a vis√£o do mapa para cobrir os limites definidos
      map.fitBounds(bounds);

      // Adiciona a imagem como overlay e trata erro de carregamento
      var overlay = L.imageOverlay(imageUrl, bounds, { opacity: 1 }).addTo(map);
      overlay.on('error', function () {
        L.popup().setLatLng(map.getCenter()).setContent('Imagem base n√£o encontrada em ' + imageUrl).openOn(map);
      });

      // Aplica um deslocamento para alinhar a imagem ao sistema de coordenadas
      var srcPt = L.latLng(-18.202508, -43.573279);
      var dstPt = L.latLng(-18.200153, -43.575919);
      var dLat = dstPt.lat - srcPt.lat;
      var dLng = dstPt.lng - srcPt.lng;
      var shifted = areaPoints.map(function (p) { return [p[0] + dLat, p[1] + dLng]; });
      var shiftedBounds = L.latLngBounds(shifted);
      overlay.setBounds(shiftedBounds);

      // Define limites e n√≠veis de zoom do mapa
      map.setMinZoom(16.5);
      map.setMaxZoom(18);
      map.setMaxBounds(shiftedBounds);
      map.fitBounds(shiftedBounds);

      // Dados dos marcadores a serem exibidos no mapa
      // Cada item pode conter: nome, lat, lng, categoria, image, descricao, instagram, site
      var markersData = [
        { nome: 'Almoxarifado', lat: -18.203389, lng: -43.575549, categoria: 'Log√≠stica', image: 'assets/img/fotos-pop-up/Almoxarifado.jpg', descricao: 'Respons√°vel pelo armazenamento e distribui√ß√£o de materiais da universidade.' },
        { nome: 'Biblioteca', lat: -18.2001528787829, lng: -43.5760135599367, categoria: 'Servi√ßo', image: 'assets/img/fotos-pop-up/Biblioteca.jpg', descricao: 'Biblioteca central com acervo f√≠sico e digital, salas de estudo e computadores.', instagram: '@bibliotecasufvjm', site: 'https://ufvjm.edu.br/biblioteca/' },
        { nome: 'Bosque', lat: -18.2002999000964, lng: -43.5753240295475, categoria: '√Årea Verde', image: 'assets/img/fotos-pop-up/Bosque.jpg', descricao: '√Årea de conviv√™ncia ao ar livre, ideal para descanso e estudos em grupo.' },
        { nome: 'Centro de P√≥s CIpq', lat: -18.198696, lng: -43.572024, categoria: 'Acad√™mico', image: 'assets/img/fotos-pop-up/CIPQ.jpeg', descricao: 'Centro de pesquisa e p√≥s-gradua√ß√£o da UFVJM.', site: 'https://portal.ufvjm.edu.br/prppg/pesquisa/infraestrutura-para-pesquisa/laboratorio-cipq' },
        { nome: 'DECOM', lat: -18.202215722936, lng: -43.5771069207662, categoria: 'Departamento', image: 'assets/img/fotos-pop-up/Decom.jpg', descricao: 'Departamento de Computa√ß√£o - Curso de Sistemas de Informa√ß√£o.', instagram: '@decom_ufvjm', site: 'http://www.decom.ufvjm.edu.br/dc2020/' },
        { nome: 'Departamento de Agronomia', lat: -18.2020544880635, lng: -43.5736118358237, categoria: 'Departamento',image: 'assets/img/fotos-pop-up/Agronomia.jpg', descricao: 'Curso de Agronomia e pesquisas em agricultura sustent√°vel.', instagram: '@agronomiaufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/agr' },
        { nome: 'Departamento de Biologia', lat: -18.1958072077952, lng: -43.5731395386659, categoria: 'Departamento',image: 'assets/img/fotos-pop-up/Biologia.jpg', descricao: 'Cursos de Ci√™ncias Biol√≥gicas - Licenciatura e Bacharelado.', instagram: '@bachbioufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/bio' },
        { nome: 'Departamento de Educa√ß√£o F√≠sica', lat: -18.196219, lng: -43.573966, categoria: 'Departamento',image: 'assets/img/fotos-pop-up/Educa√ß√£o_Fisica.jpg', descricao: 'Curso de Educa√ß√£o F√≠sica e atividades esportivas.', instagram: '@educacaofisicaufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/efs ' },
        { nome: 'Departamento de Enfermagem', lat: -18.195511, lng: -43.573580, categoria: 'Departamento',image: 'assets/img/fotos-pop-up/Enfermagem.jpg', descricao: 'Curso de Enfermagem e pr√°ticas em sa√∫de.', instagram: '@enfufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/edf' },
        { nome: 'Departamento de Farm√°cia', lat: -18.196382, lng: -43.572668, categoria: 'Departamento',image: 'assets/img/fotos-pop-up/Farm√°cia.jpg', descricao: 'Curso de Farm√°cia e laborat√≥rios de pesquisa farmac√™utica.', instagram: '@defar_ufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/far' },
        { nome: 'Departamento de Medicina', lat: -18.194354, lng: -43.574256, categoria: 'Departamento',image: 'assets/img/fotos-pop-up/Medicina.jpg', descricao: 'Curso de Medicina e Hospital Universit√°rio.', instagram: '@famedufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/med' },
        { nome: 'Departamento de Odontologia', lat: -18.193579, lng:  -43.573151, categoria: 'Departamento', image: 'assets/img/fotos-pop-up/Odontologia.jpg', descricao: 'Dinheiro jogado fora', instagram: '@odonto.ufvjm.oficial', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/odo' },
        { nome: 'Departamento de Qu√≠mica', lat: -18.202834, lng: -43.576552, categoria: 'Departamento', image: 'assets/img/fotos-pop-up/Qu√≠mica.jpeg', descricao: 'Departamento do curso de Qu√≠mica (Bacharelado e Licenciatura). Possui complexo de laborat√≥rios para ensino e pesquisa em ci√™ncias exatas.', instagram: '@quimica.ufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/qui' },
        { nome: 'Departamento de Zootecnia', lat: -18.2028258218552, lng: -43.5741621680712, categoria: 'Departamento', image: 'assets/img/fotos-pop-up/Zootecnia.jpg', descricao: 'Departamento do curso de Zootecnia. Foca na produ√ß√£o animal, nutri√ß√£o e melhoramento gen√©tico, com laborat√≥rios especializados.', instagram: '@dzoufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/zoo ' },
        { nome: 'Departamento Florestal', lat: -18.2020202064797, lng: -43.571419528717, categoria: 'Departamento', image: 'assets/img/fotos-pop-up/Florestal.jpg', descricao: 'Departamento de Engenharia Florestal. Dedicado ao manejo de recursos florestais, silvicultura e tecnologia da madeira.', instagram: '@caflorestaufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/cursos/flo' },
        { nome: 'Diretoria de Educa√ß√£o', lat: -18.2024421059305, lng: -43.5756951652816, categoria: 'Administra√ß√£o', image: 'assets/img/fotos-pop-up/diretoria_de_educacao.jpeg', descricao: 'Unidade respons√°vel pela gest√£o de pol√≠ticas educacionais e coordena√ß√£o dos cursos de Educa√ß√£o a Dist√¢ncia (EaD) da UFVJM.', instagram: '@prppg.ufvjm', site: 'https://portal.ufvjm.edu.br/prppg' },
        { nome: 'Lanchonete Central', lat: -18.1990605490143, lng: -43.5749705947735, categoria: 'Alimenta√ß√£o', image: 'assets/img/fotos-pop-up/Kebek.jpeg', descricao: 'Conhecida como Kebek, √© a principal √°rea de conviv√™ncia e alimenta√ß√£o do campus, servindo lanches e refei√ß√µes variadas.' },
        { nome: 'Lanchonete do Pavilh√£o', lat: -18.2007871361384, lng: -43.5775763771777, categoria: 'Alimenta√ß√£o', image: 'assets/img/fotos-pop-up/Lanchonete_Pavilhao.jpg', descricao: 'Ponto de alimenta√ß√£o estrat√©gica localizado pr√≥ximo √†s salas de aula dos pavilh√µes, ideal para lanches r√°pidos nos intervalos.' },
        { nome: 'Portaria', lat: -18.204454, lng: -43.580768, categoria: 'Entrada', image: 'assets/img/fotos-pop-up/Portaria.jpg', descricao: 'Acesso ao Campus JK. Realiza o controle de entrada/sa√≠da e serve como ponto de parada para transporte coletivo.' },
        { nome: 'Reitoria', lat: -18.2010170232133, lng: -43.5753023464019, categoria: 'Administra√ß√£o', image: 'assets/img/fotos-pop-up/Reitoria.jpeg', descricao: 'Edif√≠cio sede da administra√ß√£o superior. Abriga o gabinete do Reitor, as Pr√≥-Reitorias e os setores administrativos centrais da universidade.', instagram: '@reitoriaufvjm', site: 'https://portal.ufvjm.edu.br/a-universidade/reitoria' }
      ];

      // Cria marcadores e popups com conte√∫do detalhado
      markersData.forEach(function(m) {
        var ll = L.latLng(m.lat, m.lng);

        // ID √∫nico do bloco de detalhes para controle de expandir/recolher
        var popupId = 'popup-' + m.nome.replace(/\s+/g, '-').toLowerCase();

        // Constr√≥i o HTML do popup
        var popupHTML = '<div style="font-family: Gabarito, sans-serif; min-width: 220px;">';

        // Adiciona imagem se estiver definida
        if (m.image) {
          popupHTML += '<img src="' + m.image + '" alt="' + m.nome + '" style="width:100%; height:auto; max-height:180px; object-fit:contain; border-radius:4px; margin-bottom:8px; background:#f6f6f6;">';
        }

        // T√≠tulo e categoria
        popupHTML += '<strong style="font-size:16px; color:#00659f; display:block; margin-bottom:4px;">' + m.nome + '</strong>';
        popupHTML += '<span style="color:#666; font-size:13px; display:block; margin-bottom:6px;">üìç ' + (m.categoria || 'Local') + '</span>';

        // Coordenadas sempre vis√≠veis
        popupHTML += '<div style="font-size:11px; color:#999; margin-bottom:10px;">';
        popupHTML += 'Lat: ' + m.lat.toFixed(6) + ' | Lng: ' + m.lng.toFixed(6);
        popupHTML += '</div>';

        // Se houver informa√ß√µes adicionais, cria bot√£o para exibir detalhes
        if (m.descricao || m.instagram || m.site) {
          popupHTML += '<button id="btn-' + popupId + '" onclick="toggleDetails(\'' + popupId + '\')" ';
          popupHTML += 'style="width:100%; padding:8px; background:#00659f; color:white; border:none; border-radius:4px; cursor:pointer; font-family:Gabarito; font-size:13px; font-weight:600; transition:0.15s ease;"';
          popupHTML += ' onmouseover="this.style.background=\'#004a73\'" onmouseout="this.style.background=\'#00659f\'">';
          popupHTML += '‚ñº Mais detalhes</button>';

          // Conte√∫do expand√≠vel (inicialmente oculto)
          popupHTML += '<div id="' + popupId + '" style="display:none; margin-top:10px; padding-top:10px; border-top:1px solid #e0e0e0;">';

          // Descri√ß√£o
          if (m.descricao) {
            popupHTML += '<p style="font-size:13px; color:#333; line-height:1.4; margin:0 0 8px 0;">' + m.descricao + '</p>';
          }

          // Link do Instagram
          if (m.instagram) {
            popupHTML += '<div style="margin-bottom:6px;">';
            popupHTML += '<span style="font-size:12px; color:#666;">üì∑ Instagram: </span>';
            popupHTML += '<a href="https://instagram.com/' + m.instagram.replace('@', '') + '" target="_blank" style="font-size:12px; color:#00659f; text-decoration:none;">' + m.instagram + '</a>';
            popupHTML += '</div>';
          }

          // Site institucional
          if (m.site) {
            popupHTML += '<div style="margin-bottom:6px;">';
            popupHTML += '<span style="font-size:12px; color:#666;">üåê Site: </span>';
            popupHTML += '<a href="' + m.site + '" target="_blank" style="font-size:12px; color:#00659f; text-decoration:none; word-break:break-all;">' + m.site + '</a>';
            popupHTML += '</div>';
          }

          popupHTML += '</div>';
        }

        popupHTML += '</div>';

        // Adiciona o marcador no mapa com o popup
        L.marker(ll).addTo(map).bindPopup(popupHTML, {
          maxWidth: 280,
          minWidth: 220
        });
      });

      // Cria marcador ao clicar no mapa e exibe coordenadas
      var clickMarker;
      map.on('click', function(e) {
        if (clickMarker) map.removeLayer(clickMarker);
        clickMarker = L.marker(e.latlng).addTo(map);
        clickMarker.bindPopup('Coordenadas: ' + e.latlng.lat.toFixed(6) + ', ' + e.latlng.lng.toFixed(6)).openPopup();
      });

      // Fun√ß√£o global para expandir/recolher detalhes dentro dos popups
      window.toggleDetails = function(popupId) {
        var detailsDiv = document.getElementById(popupId);
        var button = document.getElementById('btn-' + popupId);

        if (detailsDiv.style.display === 'none') {
          detailsDiv.style.display = 'block';
          button.innerHTML = '‚ñ≤ Menos detalhes';
        } else {
          detailsDiv.style.display = 'none';
          button.innerHTML = '‚ñº Mais detalhes';
        }
      };
    });
  </script>

  <!-- Scripts auxiliares da aplica√ß√£o -->
  <script src="assets/js/api.js"></script>
  <script src="assets/js/profile.js"></script>

</body>
</html>
