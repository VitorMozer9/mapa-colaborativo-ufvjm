<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mapa Colaborativo UFVJM</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="assets/css/map.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400;700&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>

  <!--Barra de Busca-->
  <div id="map"></div>
  <div class="searchbar">
    <input id="searchInput" type="text" placeholder="Pesquise o local desejado" />
    <div class="chips">

      <button class="chip deselected" data-cat="Departamentos">
        <img src="assets/img/Mapa/logo2.png" alt="Logo2" class="logo2-img">Departamentos


      </button>

      <button class="chip deselected" data-cat="Lanchonetes">
        <img src="assets/img/Mapa/logo3.png" alt="Logo3" class="logo3-img">Lanchonetes</button>

      <button class="chip deselected " data-cat="Eventos">
        <img src="assets/img/Mapa/logo4.png" alt="Logo4" class="logo4-img">Eventos</button>

    </div>
  </div>


  <!--Barra Lateral-->
  <div class="sidebar">

    <div class="logo">

      <a href="index.html" class="logo-ufvjm">

        <img src="assets/img/Mapa/logo.png" alt="Logo" class="logo-img">

        <span class="leaf"></span>

      </a>
    </div>


    <!--Icones da barra lateral-->
    <div class="menu">
      <div class="item">

        <img src="assets/img/Mapa/pngegg2.png" alt="Ícone2" class="icon2">
        <span>Salvos</span>
      </div>

      <div class="item">
        <img src="assets/img/Mapa/pngegg1.png" alt="Ícone1" class="icon1">
        <span>Favoritos</span>
      </div>

      <div class="item">
        <img src="assets/img/Mapa/pngegg.png" alt="Ícone" class="icon">
        <span>Eventos</span>
      </div>

      <div class="item menu-profile-bottom">
        <a href="perfil_usuario.html" class="menu-profile-link">
          <img src="assets/img/perfil-usuário/user.png" alt="Perfil" class="icon-profile profile-avatar-img" />
          <span>Perfil</span>
        </a>
      </div>
    </div>
  </div>





  <script>
    window.addEventListener('DOMContentLoaded', function () {
      if (typeof L === 'undefined') {
        var el = document.getElementById('map');
        el.textContent = 'Falha ao carregar Leaflet. Verifique sua conexão com a internet.';
        el.style.display = 'flex';
        el.style.alignItems = 'center';
        el.style.justifyContent = 'center';
        el.style.color = '#b00020';
        el.style.fontFamily = 'system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
        return;
      }

      var map = L.map('map', { maxBoundsViscosity: 1.0 });

      var imageUrl = 'assets/img/Mapa/mapa-quadrado.png';

      var areaPoints = [
        [-18.20596, -43.58189],
        [-18.18906, -43.56978],
        [-18.20199, -43.56016],
        [-18.21125, -43.56789]
      ];
      var bounds = L.latLngBounds(areaPoints);
      var polyLatLngs = areaPoints.map(function (p) { return L.latLng(p[0], p[1]); });

      map.fitBounds(bounds);

      var overlay = L.imageOverlay(imageUrl, bounds, { opacity: 1 }).addTo(map);
      overlay.on('error', function () {
        L.popup().setLatLng(map.getCenter()).setContent('Imagem base não encontrada em ' + imageUrl).openOn(map);
      });
      var srcPt = L.latLng(-18.202508, -43.573279);
      var dstPt = L.latLng(-18.200153, -43.575919);
      var dLat = dstPt.lat - srcPt.lat;
      var dLng = dstPt.lng - srcPt.lng;
      var shifted = areaPoints.map(function (p) { return [p[0] + dLat, p[1] + dLng]; });
      var shiftedBounds = L.latLngBounds(shifted);
      overlay.setBounds(shiftedBounds);
      map.setMinZoom(16.5);
      map.setMaxZoom(18);
      map.setMaxBounds(shiftedBounds);
      map.fitBounds(shiftedBounds);


      var markersData = [
        { nome: 'Almoxarifado', lat: -18.203047464079, lng: -43.5756421509754, categoria: 'Logística' },
        { nome: 'Biblioteca', lat: -18.2001528787829, lng: -43.5760135599367, categoria: 'Serviço' },
        { nome: 'Bosque', lat: -18.2002999000964, lng: -43.5753240295475, categoria: 'Área Verde' },
        { nome: 'Centro de Pós CIpq', lat: -18.199243168563, lng: -43.57256262081, categoria: 'Acadêmico' },
        { nome: 'DECOM', lat: -18.202215722936, lng: -43.5771069207662, categoria: 'Departamento' },
        { nome: 'Departamento de Agronomia', lat: -18.2020544880635, lng: -43.5736118358237, categoria: 'Departamento' },
        { nome: 'Departamento de Biologia', lat: -18.1958072077952, lng: -43.5731395386659, categoria: 'Departamento' },
        { nome: 'Departamento de Educação Física', lat: -18.1969559272964, lng: -43.574105164036, categoria: 'Departamento' },
        { nome: 'Departamento de Enfermagem', lat: -18.1962623397701, lng: -43.573843446478, categoria: 'Departamento' },
        { nome: 'Departamento de Farmácia', lat: -18.197138053417, lng: -43.5730044995501, categoria: 'Departamento' },
        { nome: 'Departamento de Medicina', lat: -18.1954138404507, lng: -43.5743937787052, categoria: 'Departamento' }
      ];



      markersData.forEach(function (m) {
        var ll = L.latLng(m.lat, m.lng);
        var info = '<strong>' + m.nome + '</strong><br/>' + (m.categoria || '') + '<br/>' +
          'Lat: ' + m.lat.toFixed(6) + ', Lng: ' + m.lng.toFixed(6);
        L.marker(ll).addTo(map).bindPopup(info);
      });
      var clickMarker;
      map.on('click', function (e) {
        if (clickMarker) map.removeLayer(clickMarker);
        clickMarker = L.marker(e.latlng).addTo(map);
        clickMarker.bindPopup('Coordenadas: ' + e.latlng.lat.toFixed(6) + ', ' + e.latlng.lng.toFixed(6)).openPopup();
      });










    });
  </script>

  <script src="assets/js/api.js"></script>
  <script src="assets/js/profile.js"></script>

</body>