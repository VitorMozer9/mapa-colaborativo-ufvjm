<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mapa Colaborativo UFVJM</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="assets/css/map.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400;700&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>

  <!--Barra de Busca-->
  <div id="map"></div>
  <div class="searchbar">
    <input id="searchInput" type="text" placeholder="Pesquise o local desejado" />
    <div class="chips">

      <button class="chip deselected" data-cat="Departamentos">
        <img src="assets/img/Mapa/logo2.png" alt="Logo2" class="logo2-img">Departamentos


      </button>

      <button class="chip deselected" data-cat="Lanchonetes">
        <img src="assets/img/Mapa/logo3.png" alt="Logo3" class="logo3-img">Lanchonetes</button>

      <button class="chip deselected " data-cat="Eventos">
        <img src="assets/img/Mapa/logo4.png" alt="Logo4" class="logo4-img">Eventos</button>

    </div>
  </div>


  <!--Barra Lateral-->
  <div class="sidebar">

    <div class="logo">

      <a href="index.html" class="logo-ufvjm">

        <img src="assets/img/Mapa/logo.png" alt="Logo" class="logo-img">

        <span class="leaf"></span>

      </a>
    </div>


    <!--Icones da barra lateral-->
    <div class="menu">
      <div class="item">

        <img src="assets/img/Mapa/pngegg2.png" alt="√çcone2" class="icon2">
        <span>Salvos</span>
      </div>

      <div class="item">
        <img src="assets/img/Mapa/pngegg1.png" alt="√çcone1" class="icon1">
        <span>Favoritos</span>
      </div>

      <div class="item">
        <img src="assets/img/Mapa/pngegg.png" alt="√çcone" class="icon">
        <span>Eventos</span>
      </div>

      <div class="item menu-profile-bottom">
        <a href="perfil_usuario.html" class="menu-profile-link">
          <img src="assets/img/perfil-usu√°rio/user.png" alt="Perfil" class="icon-profile profile-avatar-img" />
          <span>Perfil</span>
        </a>
      </div>
    </div>
  </div>





  <script>
    window.addEventListener('DOMContentLoaded', function () {
      if (typeof L === 'undefined') {
        var el = document.getElementById('map');
        el.textContent = 'Falha ao carregar Leaflet. Verifique sua conex√£o com a internet.';
        el.style.display = 'flex';
        el.style.alignItems = 'center';
        el.style.justifyContent = 'center';
        el.style.color = '#b00020';
        el.style.fontFamily = 'system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
        return;
      }

      var map = L.map('map', { maxBoundsViscosity: 1.0 });

      var imageUrl = 'assets/img/Mapa/mapa-quadrado.png';

      var areaPoints = [
        [-18.20596, -43.58189],
        [-18.18906, -43.56978],
        [-18.20199, -43.56016],
        [-18.21125, -43.56789]
      ];
      var bounds = L.latLngBounds(areaPoints);
      var polyLatLngs = areaPoints.map(function (p) { return L.latLng(p[0], p[1]); });

      map.fitBounds(bounds);

      var overlay = L.imageOverlay(imageUrl, bounds, { opacity: 1 }).addTo(map);
      overlay.on('error', function () {
        L.popup().setLatLng(map.getCenter()).setContent('Imagem base n√£o encontrada em ' + imageUrl).openOn(map);
      });
      var srcPt = L.latLng(-18.202508, -43.573279);
      var dstPt = L.latLng(-18.200153, -43.575919);
      var dLat = dstPt.lat - srcPt.lat;
      var dLng = dstPt.lng - srcPt.lng;
      var shifted = areaPoints.map(function (p) { return [p[0] + dLat, p[1] + dLng]; });
      var shiftedBounds = L.latLngBounds(shifted);
      overlay.setBounds(shiftedBounds);
      map.setMinZoom(16.5);
      map.setMaxZoom(18);
      map.setMaxBounds(shiftedBounds);
      map.fitBounds(shiftedBounds);


      var markersData = [
        { nome: 'Almoxarifado', lat: -18.203047464079, lng: -43.5756421509754, categoria: 'Log√≠stica', descricao: 'Respons√°vel pelo armazenamento e distribui√ß√£o de materiais da universidade.' },
        { nome: 'Biblioteca', lat: -18.2001528787829, lng: -43.5760135599367, categoria: 'Servi√ßo', image: 'assets/img/slide-show-tela-inicial/Biblioteca.jpg', descricao: 'Biblioteca central com acervo f√≠sico e digital, salas de estudo e computadores.', instagram: '@bibliotecasufvjm', site: 'https://ufvjm.edu.br/biblioteca/' },
        { nome: 'Bosque', lat: -18.2002999000964, lng: -43.5753240295475, categoria: '√Årea Verde', image: 'assets/img/slide-show-tela-inicial/Bosque.jpg', descricao: '√Årea de conviv√™ncia ao ar livre, ideal para descanso e estudos em grupo.' },
        { nome: 'Centro de P√≥s CIpq', lat: -18.199243168563, lng: -43.57256262081, categoria: 'Acad√™mico', descricao: 'Centro de pesquisa e p√≥s-gradua√ß√£o da UFVJM.' },
        { nome: 'DECOM', lat: -18.202215722936, lng: -43.5771069207662, categoria: 'Departamento', image: 'assets/img/slide-show-tela-inicial/Pr√©dioSistemas.jpg', descricao: 'Departamento de Computa√ß√£o - Curso de Sistemas de Informa√ß√£o.', instagram: '@decom_ufvjm', site: 'http://www.decom.ufvjm.edu.br/dc2020/' },
        { nome: 'Departamento de Agronomia', lat: -18.2020544880635, lng: -43.5736118358237, categoria: 'Departamento', descricao: 'Curso de Agronomia e pesquisas em agricultura sustent√°vel.' },
        { nome: 'Departamento de Biologia', lat: -18.1958072077952, lng: -43.5731395386659, categoria: 'Departamento', descricao: 'Cursos de Ci√™ncias Biol√≥gicas - Licenciatura e Bacharelado.' },
        { nome: 'Departamento de Educa√ß√£o F√≠sica', lat: -18.1969559272964, lng: -43.574105164036, categoria: 'Departamento', descricao: 'Curso de Educa√ß√£o F√≠sica e atividades esportivas.' },
        { nome: 'Departamento de Enfermagem', lat: -18.1962623397701, lng: -43.573843446478, categoria: 'Departamento', descricao: 'Curso de Enfermagem e pr√°ticas em sa√∫de.' },
        { nome: 'Departamento de Farm√°cia', lat: -18.197138053417, lng: -43.5730044995501, categoria: 'Departamento', descricao: 'Curso de Farm√°cia e laborat√≥rios de pesquisa farmac√™utica.' },
        { nome: 'Departamento de Medicina', lat: -18.1954138404507, lng: -43.5743937787052, categoria: 'Departamento', descricao: 'Curso de Medicina e Hospital Universit√°rio.' }
      ];

      // Cria√ß√£o dos marcadores com popups completos
      markersData.forEach(function(m) {
    var ll = L.latLng(m.lat, m.lng);
    
    // ID √∫nico para cada popup (para controlar o toggle)
    var popupId = 'popup-' + m.nome.replace(/\s+/g, '-').toLowerCase();
    
    // Constr√≥i o HTML do popup
    var popupHTML = '<div style="font-family: Gabarito, sans-serif; min-width: 220px;">';
    
    // Imagem (se existir)
    if (m.image) {
      popupHTML += '<img src="' + m.image + '" alt="' + m.nome + '" style="width:100%; height:auto; max-height:180px; object-fit:contain; border-radius:4px; margin-bottom:8px; background:#f6f6f6;">';
    }
    
    // T√≠tulo e categoria
    popupHTML += '<strong style="font-size:16px; color:#00659f; display:block; margin-bottom:4px;">' + m.nome + '</strong>';
    popupHTML += '<span style="color:#666; font-size:13px; display:block; margin-bottom:6px;">üìç ' + (m.categoria || 'Local') + '</span>';
    
    // Coordenadas (sempre vis√≠veis)
    popupHTML += '<div style="font-size:11px; color:#999; margin-bottom:10px;">';
    popupHTML += 'Lat: ' + m.lat.toFixed(6) + ' | Lng: ' + m.lng.toFixed(6);
    popupHTML += '</div>';
    
    // Bot√£o "Mais detalhes" (se houver informa√ß√µes adicionais)
    if (m.descricao || m.instagram || m.site) {
      popupHTML += '<button id="btn-' + popupId + '" onclick="toggleDetails(\'' + popupId + '\')" ';
      popupHTML += 'style="width:100%; padding:8px; background:#00659f; color:white; border:none; border-radius:4px; cursor:pointer; font-family:Gabarito; font-size:13px; font-weight:600; transition:0.15s ease;"';
      popupHTML += ' onmouseover="this.style.background=\'#004a73\'" onmouseout="this.style.background=\'#00659f\'">';
      popupHTML += '‚ñº Mais detalhes</button>';


      // Conte√∫do expand√≠vel (inicialmente oculto)
      popupHTML += '<div id="' + popupId + '" style="display:none; margin-top:10px; padding-top:10px; border-top:1px solid #e0e0e0;">';


      if (m.descricao) {
        popupHTML += '<p style="font-size:13px; color:#333; line-height:1.4; margin:0 0 8px 0;">' + m.descricao + '</p>';
      }

      if (m.instagram) {
        popupHTML += '<div style="margin-bottom:6px;">';
        popupHTML += '<span style="font-size:12px; color:#666;">üì∑ Instagram: </span>';
        popupHTML += '<a href="https://instagram.com/' + m.instagram.replace('@', '') + '" target="_blank" style="font-size:12px; color:#00659f; text-decoration:none;">' + m.instagram + '</a>';
        popupHTML += '</div>';
      }
      
      if (m.site) {
        popupHTML += '<div style="margin-bottom:6px;">';
        popupHTML += '<span style="font-size:12px; color:#666;">üåê Site: </span>';
        popupHTML += '<a href="' + m.site + '" target="_blank" style="font-size:12px; color:#00659f; text-decoration:none; word-break:break-all;">' + m.site + '</a>';
        popupHTML += '</div>';
      }
      
      popupHTML += '</div>';
    }
    
    popupHTML += '</div>';
    
    L.marker(ll).addTo(map).bindPopup(popupHTML, {
      maxWidth: 280,
      minWidth: 220
    });
  });

  // Marcador de clique para mostrar coordenadas
  var clickMarker;
  map.on('click', function(e) {
    if (clickMarker) map.removeLayer(clickMarker);
    clickMarker = L.marker(e.latlng).addTo(map);
    clickMarker.bindPopup('Coordenadas: ' + e.latlng.lat.toFixed(6) + ', ' + e.latlng.lng.toFixed(6)).openPopup();
  });

  // Fun√ß√£o para expandir/recolher detalhes
  window.toggleDetails = function(popupId) {
    var detailsDiv = document.getElementById(popupId);
    var button = document.getElementById('btn-' + popupId);

    if (detailsDiv.style.display === 'none') {
      detailsDiv.style.display = 'block';
      button.innerHTML = '‚ñ≤ Menos detalhes';
    } else {
      detailsDiv.style.display = 'none';
      button.innerHTML = '‚ñº Mais detalhes';
    }
  };

    });
  </script>

  <script src="assets/js/api.js"></script>
  <script src="assets/js/profile.js"></script>

</body>